import"./chunk-N62S77FA.js";import{a as U,b as F}from"./chunk-JO7SL4JP.js";import{Ab as j,C as p,Fa as C,G as u,H as a,J as g,La as S,Lb as x,M as y,N as m,Ra as k,Sa as T,Ta as A,ba as I,cc as b,f as B,fa as n,fc as P,g as f,i as d,ic as l,jc as R,lc as D,qa as v,sa as w,ya as M}from"./chunk-V4K2SX2X.js";var _=B(F());var c=class{};var E=(()=>{class e extends c{constructor(i){super(),this.httpServiceGateway=i,this.getTokenPorUsuario=()=>new Promise((t,r)=>{this.httpServiceGateway.Post("/usuario/Token/PostCrearTokenPorUsuario",{}).subscribe(o=>{console.log(o),t(o)})})}static{this.\u0275fac=function(t){return new(t||e)(g(D))}}static{this.\u0275prov=u({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var z=["iframeElement"];function G(e,Q){if(e&1&&C(0,"iframe",1,0),e&2){let i=S();w("src",i.safeUrl,I)}}var N=(()=>{class e{constructor(i,t,r,o,s){this.sanitizer=i,this.dataApp=t,this.amiService=r,this.storageService=o,this.router=s,this.isViewIframe=!1,this.destroy$=new d}ngOnInit(){this.getTokenByIframe(),this.dataApp.getselectedNiu().pipe(p(this.destroy$)).subscribe(()=>{this.isViewIframe=!1,this.getTokenByIframe()}),this.dataApp.getChangeOption().pipe(p(this.destroy$)).subscribe(()=>{this.isViewIframe=!1,this.getTokenByIframe()}),window.addEventListener("message",this.getPostMessageSetHeightIframe.bind(this),!1)}getTokenByIframe(){return f(this,null,function*(){yield this.amiService.getTokenPorUsuario().then(i=>f(this,null,function*(){let t=this.storageService.readSession("itemsMenu"),r=window.location.pathname,o=t.filter(s=>s.MenControlador==r);o==null||o.length===0?_.default.fire({icon:"error",text:"La vivienda actual no tiene acceso a este apartado"}).then(()=>{this.router.navigate(["dashboard"])}):yield new Promise(s=>setTimeout(()=>{this.sendToken(o[0].Ruta,i.Data.Token),this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(o[0].Ruta+"?token="+i.Data.Token),this.isViewIframe=!0},1e3))}))})}getPostMessageSetHeightIframe(i){let t=this.iframe?.nativeElement,r=document.getElementById("content_iframe");t.style.height=i.data.value+"px",r.style.height=i.data.value+"px"}sendToken(i,t){if(this.iframe&&this.iframe.nativeElement.contentWindow){let r=this.iframe.nativeElement.contentWindow,o={token:t};r.postMessage(o,i)}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||e)(n(x),n(R),n(E),n(U),n(P))}}static{this.\u0275cmp=y({type:e,selectors:[["app-ami-complete"]],viewQuery:function(t,r){if(t&1&&k(z,5),t&2){let o;T(o=A())&&(r.iframe=o.first)}},decls:1,vars:1,consts:[["iframeElement",""],["frameborder","0","id","content_iframe",1,"w-full","height-iframe",3,"src"]],template:function(t,r){t&1&&v(0,G,2,1,"iframe",1),t&2&&M(0,r.isViewIframe?0:-1)},styles:[".height-iframe[_ngcontent-%COMP%]{height:70vh}"]})}}return e})();var O=[{path:":path",component:N}],V=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=m({type:e})}static{this.\u0275inj=a({imports:[l.forChild(O),l]})}}return e})();var pe=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=m({type:e})}static{this.\u0275inj=a({imports:[j,V,b]})}}return e})();export{pe as AMIModule};
